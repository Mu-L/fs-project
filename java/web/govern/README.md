# 数据治理（Data Governance）

该模块重点处理数据治理相关的功能，可结合在线办公、商业智能等模块形成完整的数据平台方案。

## 交互逻辑

### 元数据
- 通过采集器获取元数据，通过主外键匹配关联关系，建立物理连接。
- 配置元模型，维护模型之间的关联关系（UML类图），建立逻辑连接。
- 将元模型应用于元数据中的表，通过物理和逻辑连接建立血缘关系。

### 设计思路
- 元数据可通过主动采集或在业务端增加拦截器方式获取。
- 血缘关系可通过UML类图方式展示或关系穿透图方式。
- 元数据和数据标准可支持自定义类型和属性配置。
- 质量检测可通过数据配置或面向数据资产配置。
- 质检报告可在页面查看或生成PDF或关联自定义分析报表。
- 产品交互方式没有优劣之分，以满足生产环境实际需求为主。


## 功能模块

### 元数据
提供血缘分析、影响分析、关联度分析、差异对比等服务，支持多维度在线检索。

### 数据标准
按业务属性、技术属性、管理属性等定义数据标准，落地评估元数据管理规范并提供报表展示。

### 数据质量
按一致性、规范性、正确性、关联性、及时性、完整性、重复性等规则形成质检方案，分析逻辑数据主题生成质检报告。

### 数据安全
对数据选择性加密存取和脱敏处理，提供密钥管理和多种数据处理算法。

### 数据资产
基于在线表单和工作流程管理数据权限，监控数据访问和服务接口，采用工单维护数据内容。

### 生命周期
提供数据归档和销毁服务，记录数据从创建到销毁的完整过程。

### 数据交换
通过API授权和订阅，提供数据变更通知和同步服务，支持全量和增量拉取。
提供数据源读取、数据清洗、目标位置写入服务，支持离线采集、CDC接入、人工导入、FTP传输等功能。

## 相关服务

### 在线办公
采用在线表单和工作流程，提供数据填报、工单审批等功能。

### 定时任务
提供服务编排和多任务顺序调度服务，支持事件通知、在线查看调度日志和执行日志。

### 在线报表
提供即席查询的在线分析服务，支持预计算和可视化报表。

### 商业智能
集成通用算法、机器学习、神经网络模型，提供用户画像、数据挖掘、智能推荐等功能。

## 业务概念

### 数据标准属性

- 业务属性：标准主题、一级分类、二级分类、三级分类、业务含义、业务规则、参考文档、引用公共代码。
- 技术属性：数据类型、数据格式、数据长度、数据精度、可为空。
- 管理属性：归属管理部门、引用编号、权威系统、协办部门。
- 质量属性：字符规范、值域范围、不允许为空。
- 主数据属性：置信度、整合规则。
- 生命周期属性：归档方式、归档方案、归档模式、销毁方式、销毁方案。

### 数据质量规则

| 规则类型 | 检测逻辑 | 规则描述 | 检测对象（不跨源） | 使用规则 |
| :----- | :----- | :----- | :----- | :----- |
| 一致性 | 1、单表内两个字段数据一致情况；2、同源两表的两个字段数据一致； | 用于检测单表或两表同一实体的同一属性存在差异性质量问题 | 单表，多表 | SQL规则、函数依赖规则、字典规则、包含依赖规则 |
| 规范性 | 检测某字段数据的规范，如日期格式，身份证号码，地址规范，邮政编码，房屋编码等 | 用于检测某字段符合规范质量问题 | 单表，单字段 | 正则表达式，标准包，SQL规则，值域规则、元规则 |
| 正确性 | 正确性是指数据正确反映了其实体的真实属性 |  |  | SQL规则，值域规则、异常规则 |
| 关联性 | 1、两个字段之和等于某个字段的值；2、多表之前的关联字段丢失（比如A表员工基础表的工号表经过加密处理，B表员工绩效表的工号未经过加密处理，导致A表，B表的关联性缺失，员工绩效信息查阅不到） |  |  | SQL规则、包含依赖规则 |
| 及时性 | 1.数据产生时间到数据可查阅时间是否超期（比如：客户要求每个月的社保数据最迟3天后可以查阅到，那么8月份的社保数据，抽取到共享平台是9月4号，这就是不及时的数据） |  |  | SQL规则、时效性 |
| 完整性 | 1、单个字段不允许为空；2、多个字段不允许为空（多个字段不允许同时为空）；3、条件过滤（某个字段为某值时，某字段不能为空）； | 用于检测单表数据存在空值质量问题 | 单表，多表 |  |
| 重复性 |  | 用于检测单表存在数据重复质量问题 | 单表 |  |

## 大数据

主要围绕数据采集、分布式存储、数据分析、报表展示、任务调度、数据治理引入相关的服务，以求在特定时间内获取相应的计算结果，应重点理解各组件的运行机制、适用场景、优缺点。

### 选型
- 日志采集：Flume、Logstash、Filebeats。
- CDC同步：Canal、Maxwall、Debezium、FlinkCDC。
- 消息队列：Kafka、RabbitMQ、RocketMQ、ActiveMQ。
- 图数据库：Neo4j、JanusGraph、NebulaGraph。
- 数据湖：Delta、Iceberg、Hudi。

### 组件
- Hadoop：计算框架，提供Yarn资源调度、HDFS文件存储、HBase数据存储等上层服务。
- HDFS：分布式文件存储。
- HBase：KV存储，文件存放在HDFS中。
- Hive：提供HDFS、HBase的SQL查询能力。
- Spark：计算框架，提供离线批处理计算、微批处理流式计算、SQL计算、机器学习、图计算等服务。
- Flink：计算框架，提供近实时流处理、批处理、SQL计算、CDC同步等服务。
- ClickHouse：在线分析，支持亿级单表数据的亚秒级查询。
- Kylin：预处理平台，基于Cube在Hadoop或Spark中进行预计算，提供JDBC、Rest接口亚秒级查询服务。
- Zeppelin：文档笔记，类jupyter集成后端计算服务。
- Atlas：数据治理，仅提供原数据导入查询和血缘分析。
- Superset：数据可视化，提供多种数据源的单表分析报表。
- Sentinel：流量控制，属于微服务范涛。
- Azkaban：任务调度，提供多任务的工作流式编排调度。
- Oozie：任务调度，基于Hadoop的老牌服务，比较难使，看日志不方便。
- Sqoop：离线采集，将关系型数据库导入到Hadoop中。
- DataX：离线采集，阿里出品，提供多种数据源的交换。
- Zookeeper：分布式配置服务，常作为kafka、hbase等的依赖。

### 对照

- OLAP

| 组件 | 优势 | 缺点 |
| :----- | :----- | :----- |
| Druid | 海量数据亚秒级分析响应、端到端实时（入库、预聚合、查询）、自成体系、原生支持Lambda和Kappa架构 | 不适合即席查询分析（提前定义模型预聚合了）、不支持明细数据查询、不支持原生Join、不支持精确去重、SQL支持处于实验阶段（截止Druid0.14）、内部组件多运维繁琐 |
| Kylin | 海量数据亚秒级分析响应、可调控的精确去重、SQL原生支持、中文社区支持、原生支持Lambda和Kappa架构 | 不适合即席查询分析（提前定义模型预聚合了）、不支持明细数据查询、预计算量大（批量构建时）、实时构建发布时间不长恐有Bug、外部依赖较多运维繁琐(HBase、Hive)。 |
| Kudu | 一个存储搞定快速明细数据入库和快速分析 | 扩展能力有限无法支持更大规模数据（单机群300节点为佳）、更大规模数据需要结合Impala＋HDFS实现分层存储架构  |
| ElasticSearch | 实时全文检索能力强大、体系完备稳定尤其ELK | 不适合更大规模数据处理（不支持预聚合）、组合查询性能欠佳 |
| Presto/Trino | 跨数据源海量数据即席分析（明细数据） | 不支持海量数据实时分析（不支持预聚合） |
| Impala | 跨部分数据源海量数据即席分析（明细数据） | 不支持海量数据实时分析（不支持预聚合） |
| ClickHouse | 海量明细数据下的实时分析、SQL支持 | 数据量太大容易出现瓶颈（退而求其次去选择支持预聚合的技术） |
